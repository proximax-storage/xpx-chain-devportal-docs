---
id: update-mechanism
title: Update mechanism
---

## Problem description

Most of the blockchains don't support version compatibility.
This means that source code changes frequently require extra
efforts to upgrade software on nodes, sometimes leading to restart
of the blockchain and loosing some (or all) data accumulated there
by the moment. While it's not an issue for the testnet, it
certainly will be for public network.

In order to allow for catapult version compatibility certain changes
required in the catapult implementation.

## Implementation

All binary data (e.g. blocks, transactions, etc) will be tied
to versions of notifications. Along with adding a new version of
binary data a new version of notification and validators/observers
of that notification will be added. This way all versions will be
available and allowed any time, and will allow for smooth software
updates and even switching back to previous software versions if
required without blocking the blockchain. Also blockchain clients
may work with older versions of binary data if it is suitable for
them.

## Software update

The catapult software update will be announced via blockchain.
Only nemesis account will be able to publish software update
transaction. The transaction will set an interim time interval
(in blocks) during which software update should happen. Nodes
any time during the update interval will update catapult software
but the changes will not apply until the end of the update interval.
This will allow for blockchain to function normally all the time.
After the end of the update interval older software will become non-functional.

## Catapult configuration

The software update transaction (besides particular information
about the software update) will also announce catapult configuration
changes. Thus the catapult configuration will be updated and synchronized
between nodes via blockchain. The transaction may be announced with
configuration update only without actual software update.
The catapult configuration will be versioned allowing for reversing
it back when required. Deprecated block and transaction versions will
be added to the configuration allowing to block certain software updates
if they proved to have a bug. This approach will allow to change nemesis
account key pair if required.

## Notification

```c++
/// A basic notification.
struct Notification {
public:
    /// Creates a new notification with \a type and \a size.
    explicit Notification(NotificationType type, size_t size, VersionType version)
            : Type(type)
            , Size(size)
            , Version(version)
    {}

public:
    /// Notification type.
    NotificationType Type;

    /// Notification size.
    size_t Size;

    /// Notification version.
    VersionType Version;
};
```

## Validators/Observers

Validators/observers will handle notifications depending on
version. This way original behavior will be preserved for
older versions of catapult entities allowing to load blocks
generated by older software.

## Storage

Cache data entries will have version field. Serialization/deserialization
of cache data entries will have different implementations depending
on the version. This applies to both RocksDB and MongoDB.

